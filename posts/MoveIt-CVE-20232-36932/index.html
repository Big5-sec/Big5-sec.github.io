<!DOCTYPE html>







<html lang="en"
  
    data-mode="dark"
  
>

  <!--
  The Head
-->

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <!-- Allow having a localized datetime different from the appearance language -->
  

  

    

    

  

  <!-- Begin Jekyll SEO tag v2.8.0 -->
<meta name="generator" content="Jekyll v4.3.3" />
<meta property="og:title" content="CVE-2023-36932 - Progress MoveIt authenticated SQLi" />
<meta property="og:locale" content="en" />
<meta name="description" content="TL;DR" />
<meta property="og:description" content="TL;DR" />
<link rel="canonical" href="https://big5-sec.github.io/posts/MoveIt-CVE-20232-36932/" />
<meta property="og:url" content="https://big5-sec.github.io/posts/MoveIt-CVE-20232-36932/" />
<meta property="og:site_name" content="yar-eb" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2024-01-25T22:50:40+01:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="CVE-2023-36932 - Progress MoveIt authenticated SQLi" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2024-01-25T22:50:40+01:00","datePublished":"2024-01-25T22:50:40+01:00","description":"TL;DR","headline":"CVE-2023-36932 - Progress MoveIt authenticated SQLi","mainEntityOfPage":{"@type":"WebPage","@id":"https://big5-sec.github.io/posts/MoveIt-CVE-20232-36932/"},"url":"https://big5-sec.github.io/posts/MoveIt-CVE-20232-36932/"}</script>
<!-- End Jekyll SEO tag -->


  <title>CVE-2023-36932 - Progress MoveIt authenticated SQLi | yar-eb
  </title>

  <!--
  The Favicons for Web, Android, Microsoft, and iOS (iPhone and iPad) Apps
  Generated by: https://realfavicongenerator.net/
-->



<link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png">
<link rel="manifest" href="/assets/img/favicons/site.webmanifest">
<link rel="shortcut icon" href="/assets/img/favicons/favicon.ico">
<meta name="apple-mobile-web-app-title" content="yar-eb">
<meta name="application-name" content="yar-eb">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml">
<meta name="theme-color" content="#ffffff">


  <!-- Google Fonts -->
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous">
  <link rel="dns-prefetch" href="https://fonts.gstatic.com">

  <!-- GA -->
  

  <!-- jsDelivr CDN -->
  <link rel="preconnect" href="https://cdn.jsdelivr.net">
  <link rel="dns-prefetch" href="https://cdn.jsdelivr.net">

  <!-- Bootstrap -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css">

  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css">

  <!--
  CSS selector for site.
-->

<link rel="stylesheet" href="/assets/css/style.css">


  <link rel="stylesheet"
    href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css">



  <!-- Manific Popup -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css">



  <!-- JavaScript -->

  <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script>

</head>


  <body data-spy="scroll" data-target="#toc" data-topbar-visible="true">

    <!--
  The Side Bar
-->

<div id="sidebar" class="d-flex flex-column align-items-end">
  <div class="profile-wrapper text-center">
    <div id="avatar">
      <a href="/" alt="avatar" class="mx-auto">
        
        
        <img src="
        
        /assets/avatar.jpg
        
        " alt="avatar" onerror="this.style.display='none'">
        
      </a>
    </div>

    <div class="site-title mt-3">
      <a href="/">yar-eb</a>
    </div>
    <div class="site-subtitle font-italic">Yet another reverse-engineer blog</div>

  </div><!-- .profile-wrapper -->

  <ul class="w-100">

    <!-- home -->
    <li class="nav-item">
      <a href="/" class="nav-link">
        <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i>
        <span>HOME</span>
      </a>
    </li>

    <!-- the real tabs -->
    
    <li class="nav-item">
      <a href="/blogposts/" class="nav-link">
        <i class="fa-fw fas fa-book ml-xl-3 mr-xl-3 unloaded"></i>
        

        <span>BLOGPOSTS</span>
      </a>
    </li> <!-- .nav-item -->
    
    <li class="nav-item">
      <a href="/advisories/" class="nav-link">
        <i class="fa-fw fas fa-bug ml-xl-3 mr-xl-3 unloaded"></i>
        

        <span>ADVISORIES</span>
      </a>
    </li> <!-- .nav-item -->
    


  </ul> <!-- ul.nav.flex-column -->

  <div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center">
    
    

    
    <a href="https://github.com/Big5-sec" aria-label="github" target="_blank" rel="noopener" >
      <i class="fab fa-github"></i>
    </a>
    

    
    

    
    <a href="/feed.xml" aria-label="rss" >
      <i class="fas fa-rss"></i>
    </a>
    

    

  </div> <!-- .sidebar-bottom -->

</div><!-- #sidebar -->

    <!--
  The Top Bar
-->

<div id="topbar-wrapper" class="row justify-content-center">
  <div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between">
    <span id="breadcrumb">
      
        
          <span><a href="/advisories">Advisories</a></span>
          <span>CVE-2023-36932 - Progress MoveIt authenticated SQLi</span>
        
      
    </span><!-- endof #breadcrumb -->

    <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i>

    <div id="topbar-title">
      Post
    </div>

    <i id="search-trigger" class="fas fa-search fa-fw"></i>
    <span id="search-wrapper" class="align-items-center">
      <i class="fas fa-search fa-fw"></i>
      <input class="form-control" id="search-input" type="search"
        aria-label="search" autocomplete="off" placeholder="Search...">
      <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i>
    </span>
    <span id="search-cancel" >Cancel</span>
  </div>

</div>


    <div id="main-wrapper">
      <div id="main">

        



<div class="row">

  <!-- core -->
  <div id="core-wrapper" class="col-12 col-lg-11 col-xl-8">
    <div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4">

    

    
      
      
        <!--
  Refactor the HTML structure.
-->



<!--
  In order to allow a wide table to scroll horizontally,
  we suround the markdown table with `<div class="table-wrapper">` and `</div>`
-->



<!--
  Fixed kramdown code highlight rendering:
  https://github.com/penibelst/jekyll-compress-html/issues/101
  https://github.com/penibelst/jekyll-compress-html/issues/71#issuecomment-188144901
-->



<!-- Add attribute 'hide-bullet' to the checkbox list -->



<!-- images -->




  
  

  
    
      
      
    

    
    
    

    
    

    
    
    

    
      
      

      
      

      

      
    
      
      

      
      

      

      
    

    
      

        <!-- Add CDN URL -->
        

        <!-- Add image path -->
        

        
        

      

      <!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> -->

      

    

    <!-- Add SVG placehoder to prevent layout reflow -->

    

    <!-- Bypass the HTML-proofer test -->
    

    

  
    

    
    
    

    
    

    
    
    

    
      
      

      
      

      

      
    
      
      

      
      

      

      
    

    
      

        <!-- Add CDN URL -->
        

        <!-- Add image path -->
        

        
        

      

      <!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> -->

      

    

    <!-- Add SVG placehoder to prevent layout reflow -->

    

    <!-- Bypass the HTML-proofer test -->
    

    

  

  



<!-- Add header for code snippets -->



<!-- Create heading anchors -->





  
  

  
    
    

    
      
        
        
      

      
      

      
      
      
      

      

    
      

      
      

      
      
      
      

      

    
      

      
      

      
      
      
      

      

    
      

      
      

      
      
      
      

      

    

    

  

  
  

  

  
  

  

  
  

  




<!-- Wrap prompt element of blockquote with the <div> tag -->







<!-- return -->







<h1 data-toc-skip>CVE-2023-36932 - Progress MoveIt authenticated SQLi</h1>

<div class="post-meta text-muted">

  <!-- author -->
  <!-- <div>
    
    

    

    By
    <em>
      
        <a href="https://github.com/Big5-sec">Zilio Nicolas</a>
      
    </em>
  </div> -->

  <div class="d-flex">
    <div>
      <!-- published date -->
      <span>
        Posted
        <!--
  Date format snippet
  See: ${JS_ROOT}/utils/timeago.js
-->

<em class="timeago"
    data-ts="1706219440"
    
      data-toggle="tooltip" data-placement="bottom" data-tooltip-df="llll"
    
    >
  2024-01-25
</em>

      </span>

      <!-- lastmod date -->
      

      <!-- read time -->
      <!--
  Calculate the post's reading time, and display the word count in tooltip
 -->



<!-- words per minute  -->










<!-- return element -->
<span class="readtime" data-toggle="tooltip" data-placement="bottom"
  title="782 words">
  <em>4 min</em> read</span>


      <!-- page views -->
      <!--  -->
    </div>

  </div> <!-- .d-flex -->

</div> <!-- .post-meta -->

<div class="post-content">
  <h2 id="tldr">TL;DR <a href="#tldr" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2>

<p>A SQL injection can be triggered through header crafting, for MySQL backend, in <em>moveitisapi.dll</em>. This SQLi can only be triggered authenticated, and I do not know if there is a configuration under which it could have beeen exploited. So clearly this vulnerability would fall under the Low or even None severity.</p>

<p>To note: I’m almost certain that CVE-2023-36932 describes multiple SQL injection vulnerabilities, and I only reported one.</p>

<h2 id="description">Description: <a href="#description" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2>

<p>Quite late to the vuln research party following the 0day exploitation surge in June 2023, I decided to spend a few hours looking for SQLi on an area that should be less scrutinized than the core logic of MoveIt Transfer application, which is the ISAPI dll-<code class="language-plaintext highlighter-rouge">moveitisapi.dll</code>. Indeed, it’s binary code that is intrinsicaly harder to research than .Net code that can be decompiled.</p>

<p><code class="language-plaintext highlighter-rouge">moveitisapi.dll</code> handles several HTTP requests by itself. One of them allows a user to download a “large” file. Inside the function responsible to handle this download, multiple values are extracted from the headers of the HTTP requestfor further processing, such as the <em>username</em>, the <em>password</em>, or the <em>FileID</em>:</p>

<p><img data-src="/assets/img/2024-01-26-MoveIt-CVE-2023-36932/moveit1.png" alt="moveit1" data-proofer-ignore></p>

<p>In case the request is determined to not use <em>machine2 URL</em>, <code class="language-plaintext highlighter-rouge">moveitisapi.dll</code> will handle the rest of the request itself. To do so, it will execute several SQL queries, especially the following one: <code class="language-plaintext highlighter-rouge">SELECT * FROM files WHERE ID='XXX'</code> where the <em>FileID</em> is extracted from the <em>X-siLock-FileID</em> header:</p>

<p><img data-src="/assets/img/2024-01-26-MoveIt-CVE-2023-36932/moveit2.png" alt="moveit2" data-proofer-ignore></p>

<p>As seen in the code snippet, this header is neuteurized before the SQL query, through a function I personally call <em>escape_sql</em>.</p>

<p>Within this function, as the third argument passed to it is null, ticks will be doubled, but escape_sequence <code class="language-plaintext highlighter-rouge">\</code> are left as is. This means it’s possible to escape the neuteurization and to obtain a valid payload for MySQL backend (MSSQL won’t work), through the following payload <code class="language-plaintext highlighter-rouge">\'</code> that gets transformed into <code class="language-plaintext highlighter-rouge">\''</code>.</p>

<p>One example to trigger a potential SQL injection payload would be to use the following HTTP header: <code class="language-plaintext highlighter-rouge">X-siLock-FileID: 123\'; drop table users;#</code>, that once escaped and inserted into the query creates the following SQL query: <code class="language-plaintext highlighter-rouge">SELECT * FROM files WHERE ID='123\''; drop table users;#'; </code></p>

<h2 id="poc">POC <a href="#poc" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2>

<ol>
  <li>
    <p>obtain a valid session to make sure <em>machine2</em> is not used.</p>
  </li>
  <li>
    <p>send the following request but with the session obtained at previous step:</p>

    <div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre></td><td class="rouge-code"><pre>GET /moveitisapi/moveitisapi.dll?action=download HTTP/1.1
 
Host: localhost
X-siLock-FileID: 123\'; drop table users;#
X-siLock-Username: b5ddiwqgrfr3k315
X-siLock-IPAddress: 127.0.0.1
X-siLock-AgentBrand: titi
X-siLock-AgentVersion: 1
Cache-Control: max-age=0
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/114.0.5735.134 Safari/537.36
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7
Cookie: ASP.NET_SessionId=fe3cryhlppu1tml4zvij1cj2
Connection: close
</pre></td></tr></tbody></table></code></div>    </div>
  </li>
</ol>

<h2 id="impactexploitation">Impact/Exploitation <a href="#impactexploitation" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2>

<p>I encountered several problematics while trying to exploit the vulnerability:</p>

<ul>
  <li>
    <p>the <em>FileID</em> header can be filled with 32 characters max. Hence it’s not possible to trigger a SQL query that would allow for privilege escalation. There is no leak of information so it can’t be used for that either. Only remaining possibilities are to alter availability by destroying database (using <em>DROP TABLE</em> or <em>shutdown</em>), or to try to use SQL injection to download files we should not.</p>
  </li>
  <li>
    <p>Using the SQL injection to try to download files we are not supposed to does not appear possible: there is a <em>folderperms</em> SQL request that is done afterwards to check whether the user can download the file. For this SQL query, the <em>escape_sql</em> function third argument is set to 1 while using MySQL, making the injection not possible.</p>
  </li>
  <li>
    <p>finally, if we try to alter availability through <em>DROP TABLE</em> or <em>shutdown</em>, by default we should obtain the following log that indicates an error:</p>

    <div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre></td><td class="rouge-code"><pre>   ```
  &lt;timestamp&gt;  328:Error running SQL: SELECT * FROM files WHERE ID='123\''; drop table users;#';
  &lt;timestamp&gt;  328:** The error was [MySQL][ODBC 8.0(w) Driver][mysqld-8.0.32-commercial]You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near 'drop table users;#'' at line 1
  &lt;timestamp&gt;  328:Reconnecting to DB because query failed
  &lt;timestamp&gt;  328:Reconnected to DB OK
  &lt;timestamp&gt;  328:Error running SQL: SELECT * FROM files WHERE ID='123\''; drop table users;#';
  &lt;timestamp&gt;  328:** The error was Cannot change the ActiveConnection property of a Recordset object which has a Command object as its source.
  &lt;timestamp&gt;  328:Using machine2 because query failed a second time
  ```
</pre></td></tr></tbody></table></code></div>    </div>

    <p>This error appears to be there because the <a href="https://dev.mysql.com/doc/c-api/5.7/en/c-api-multiple-queries.html">MYSQL_OPTION_MULTI_STATEMENTS_ON</a> option is not set while connecting to the database through the ODBC driver. To be honest, I don’t know if there are cases where this option can be set by installation, or if a given user who modified the connection string in the <em>DMZConfig2.exe</em> application could have this option set.</p>
  </li>
</ul>

<p>To conclude, I was not able to fully exploit the vulnerability. Still, Progress thankfully accepted the report for defense in depth purpose.</p>

</div>


      
    
    

    </div>
  </div> <!-- #core-wrapper -->

  <!-- pannel -->
  <div id="panel-wrapper" class="col-xl-3 pl-2 text-muted">
    
      
      



<!-- BS-toc.js will be loaded at medium priority -->
<script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script>

<div id="toc-wrapper" class="pl-0 pr-4 mb-5">
  <div class="panel-heading pl-3 pt-2 mb-2">Contents</div>
  <nav id="toc" data-toggle="toc"></nav>
</div>


    
  </div>

</div>

<!-- tail -->



      </div>

      <!--
  The Search results
-->
<div id="search-result-wrapper" class="d-flex justify-content-center unloaded">
  <div class="col-12 col-sm-11 post-content">
    <div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div>
  </div>
</div>


    </div> <!-- #main-wrapper -->

    

    <div id="mask"></div>

    <a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button">
      <i class="fas fa-angle-up"></i>
    </a>

    <!--
  Jekyll Simple Search loader
  See: <https://github.com/christian-fei/Simple-Jekyll-Search>
-->





<script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script>

<script>
SimpleJekyllSearch({
  searchInput: document.getElementById('search-input'),
  resultsContainer: document.getElementById('search-results'),
  json: '/assets/js/data/search.json',
  searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0">  <a href="{url}">{title}</a>  <div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1">    {categories}    {tags}  </div>  <p>{snippet}</p></div>',
  noResultsText: '<p class="mt-5">Oops! No result founds.</p>',
  templateMiddleware: function(prop, value, template) {
    if (prop === 'categories') {
      if (value === '') {
        return `${value}`;
      } else {
        return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`;
      }
    }

    if (prop === 'tags') {
      if (value === '') {
        return `${value}`;
      } else {
        return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`;
      }
    }
  }
});
</script>


    <!--
  JS selector for site.
-->

<!-- layout specified -->


  



  <!-- image lazy-loading & popup -->
  <script src="https://cdn.jsdelivr.net/combine/npm/lozad/dist/lozad.min.js,npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/clipboard@2/dist/clipboard.min.js"></script>




  

  <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1,npm/dayjs@1/locale/en.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script>





<script defer src="/assets/js/dist/post.min.js"></script>



<!-- commons -->

<script src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.16.1,npm/bootstrap@4/dist/js/bootstrap.min.js"></script>




  </body>

</html>

